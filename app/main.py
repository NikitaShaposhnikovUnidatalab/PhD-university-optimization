import streamlit as st
from utils.state import init_state_obj, init_state_value, QS_INPUT, QS_WEIGHTS, QS_MAX, QS_DELTA, QS_COST, MAX_RU

st.set_page_config(
    page_title="QS Ranking Optimizer", 
    page_icon="üéì", 
    layout="wide",
    initial_sidebar_state="collapsed"
)

# –ü—Ä–∏—Ö–æ–≤—É—î–º–æ sidebar –ø–æ–≤–Ω—ñ—Å—Ç—é
st.markdown("""
<style>
    [data-testid="stSidebar"] {
        display: none;
    }
    [data-testid="collapsedControl"] {
        display: none;
    }
</style>
""", unsafe_allow_html=True)

# –û—Ç—Ä–∏–º—É—î–º–æ mode –∑ query parameters
query_params = st.query_params
mode = query_params.get("mode", "full")

# –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ session state
if "app_mode" not in st.session_state:
    st.session_state["app_mode"] = mode
    print(f"üéØ –†–µ–∂–∏–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: {mode}")

# –û–Ω–æ–≤–ª—é—î–º–æ —Ä–µ–∂–∏–º —è–∫—â–æ –∑–º—ñ–Ω–∏–≤—Å—è query parameter
if st.session_state.get("app_mode") != mode:
    st.session_state["app_mode"] = mode
    print(f"üîÑ –†–µ–∂–∏–º –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: {mode}")

st.title("üéì QS Ranking Optimizer")
st.markdown("**–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Ä–µ–π—Ç–∏–Ω–≥—É —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π —É QS World University Rankings**")

print("üéì –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É")
print(f"üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Å–µ—Å—ñ—ó: {list(st.session_state.keys())}")
print(f"üéØ –ü–æ—Ç–æ—á–Ω–∏–π —Ä–µ–∂–∏–º: {st.session_state.get('app_mode', 'full')}")

app_mode = st.session_state.get("app_mode", "full")

# –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–∂–∏–º—É —Ç–∞ –ø–µ—Ä–µ–º–∏–∫–∞—á
if app_mode == "simple":
    st.info("üìå **–ü–æ—Ç–æ—á–Ω–∏–π —Ä–µ–∂–∏–º:** Simplify (—Ç—ñ–ª—å–∫–∏ –õ—ñ–Ω—ñ–π–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è) | üîó [–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Full –≤–µ—Ä—Å—ñ—é](?mode=full)")
else:
    st.success("üìå **–ü–æ—Ç–æ—á–Ω–∏–π —Ä–µ–∂–∏–º:** Full (–ì–µ–Ω–µ—Ç–∏—á–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º + –õ—ñ–Ω—ñ–π–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è + –¢–æ–ø-N) | üîó [–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ Simplify –≤–µ—Ä—Å—ñ—é](?mode=simple)")

st.markdown("---")

col1, col2 = st.columns([2, 1])
with col1:
    st.markdown("""
    ### üéØ –ü—Ä–æ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫
    
    –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º:
    - **–û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∏** QS —Ä–µ–π—Ç–∏–Ω–≥—É –¥–ª—è 2026 —Ä–æ–∫—É
    - **–ó–Ω–∞–π—Ç–∏ –Ω–∞–π–∫—Ä–∞—â—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó** –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –≤ –º–µ–∂–∞—Ö –±—é–¥–∂–µ—Ç—É
    - **–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø—ñ–¥—Ö–æ–¥–∏** –¥–æ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
    - **–í—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏** —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
    """)
    
    if app_mode == "simple":
        st.markdown("""
    ### üìä –î–æ—Å—Ç—É–ø–Ω—ñ –º–µ—Ç–æ–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
    - **–õ—ñ–Ω—ñ–π–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è** - –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ —Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥
        """)
    else:
        st.markdown("""
    ### üìä –î–æ—Å—Ç—É–ø–Ω—ñ –º–µ—Ç–æ–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó:
    - **–ì–µ–Ω–µ—Ç–∏—á–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º** - –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è
    - **–õ—ñ–Ω—ñ–π–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è** - –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ —Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥
    - **–¢–æ–ø-N —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫ –Ω–∞–π–∫—Ä–∞—â–∏—Ö –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π
        """)

with col2:
    st.info("""
    **üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç:**
    
    1. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
    2. –û–±–µ—Ä—ñ—Ç—å –º–µ—Ç–æ–¥ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
    3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –∞–Ω–∞–ª—ñ–∑
    4. –û—Ç—Ä–∏–º–∞–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
    """)

st.markdown("---")

st.subheader("üéØ –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É")

col1, col2 = st.columns(2)

with col1:
    st.markdown("### ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è")
    st.markdown("–í–≤–µ–¥—ñ—Ç—å –ø–æ—Ç–æ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤, –≤–∞–≥–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è")
    if st.button("‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏", type="primary", use_container_width=True):
        print("üîß –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω—É–≤ –∫–Ω–æ–ø–∫—É '–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏' - –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó")
        st.switch_page("pages/_input_config.py")

with col2:
    st.markdown("### üöÄ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è")
    st.markdown("–ó–∞–ø—É—Å—Ç—ñ—Ç—å –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é –∑ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏")
    if st.button("üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é", type="secondary", use_container_width=True):
        print("üöÄ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–Ω—É–≤ –∫–Ω–æ–ø–∫—É '–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é' - —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å—Ç–∞–Ω—É —Ç–∞ –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó")
        print(f"üìä –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å—Ç–∞–Ω –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: MAX_RU={MAX_RU}")
        init_state_obj("QS_INPUT", QS_INPUT)
        init_state_obj("QS_WEIGHTS", QS_WEIGHTS)
        init_state_obj("QS_MAX", QS_MAX)
        init_state_obj("QS_DELTA", QS_DELTA)
        init_state_obj("QS_COST", QS_COST)
        init_state_value("MAX_RU", MAX_RU)
        print(f"üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω —Å–µ—Å—ñ—ó: {list(st.session_state.keys())}")
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ä–µ–∂–∏–º—É
        if app_mode == "simple":
            st.switch_page("pages/_genetic_optimizer_simple.py")
        else:
            st.switch_page("pages/_genetic_optimizer.py")


st.markdown("---")
st.subheader("‚ú® –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏")

features_col1, features_col2 = st.columns(2)

if app_mode == "simple":
    with features_col1:
        st.markdown("""
        **üîß –õ—ñ–Ω—ñ–π–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è:**
        - –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ —Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥
        - –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è
        - –®–≤–∏–¥–∫–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
        - –û–ø—Ç–∏–º—ñ–∑—É—î –≤—Å—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –∞–±–æ –æ–±—Ä–∞–Ω—ñ
        """)
    
    with features_col2:
        st.markdown("""
        **üìà –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è:**
        - –ì—Ä–∞—Ñ—ñ–∫–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤
        - –ê–Ω–∞–ª—ñ–∑ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤–∏—Ç—Ä–∞—Ç
        - –†–æ–∑–ø–æ–¥—ñ–ª –±—é–¥–∂–µ—Ç—É
        - –î–µ—Ç–∞–ª—å–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        """)
else:
    with features_col1:
        st.markdown("""
        **üéØ –ì–µ–Ω–µ—Ç–∏—á–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º:**
        - –û–ø—Ç–∏–º—ñ–∑—É—î –≤—Å—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ
        - –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–∏–π –æ–ø—Ç–∏–º—É–º
        - –í—Ä–∞—Ö–æ–≤—É—î –æ–±–º–µ–∂–µ–Ω–Ω—è –±—é–¥–∂–µ—Ç—É
        
        **üîß –õ—ñ–Ω—ñ–π–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è:**
        - –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ —Ç–æ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥
        - –ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è
        - –®–≤–∏–¥–∫–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
        """)

    with features_col2:
        st.markdown("""
        **üèÜ –¢–æ–ø-N —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó:**
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π
        - –ê–Ω–∞–ª—ñ–∑ –Ω–∞–π–∫—Ä–∞—â–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
        - –î–µ—Ç–∞–ª—å–Ω–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
        
        **üìà –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è:**
        - –ì—Ä–∞—Ñ—ñ–∫–∏ –¥–∏–Ω–∞–º—ñ–∫–∏ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
        - Heatmap —Å—Ç—Ä–∞—Ç–µ–≥—ñ–π
        - –ê–Ω–∞–ª—ñ–∑ –≤–Ω–µ—Å–∫—É –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤
        """)

st.markdown("---")
st.markdown("""
<div style='text-align: center; color: #666;'>
    <p>üéì QS Ranking Optimizer | –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤ —É —Å–≤—ñ—Ç–æ–≤–∏—Ö —Ä–µ–π—Ç–∏–Ω–≥–∞—Ö</p>
</div>
""", unsafe_allow_html=True)